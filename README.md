# EASYBET

⬆ 可以️修改成你自己的项目名。

> 第二次作业要求（以下内容提交时可以删除）：
> 
> 进阶的去中心化彩票系统，参与方包括：竞猜玩家、公证人
>
> **背景**：传统的体育彩票系统（例如我国的体育彩票）一般没有彩票交易功能：例如，对于“NBA本赛季MVP为某球员/F1的赛季总冠军为某车队”这类持续时间长的事件的下注一般在赛季开始前就会买定离手，这使得一旦出现突发或不确定事件（如球员A赛季报销/球队B买入强力球星/C车队车手受伤等），很多玩家的选择便会立即失去意义，导致彩票游戏的可玩性下降。因此，一个有趣的探索方向是让彩票系统拥有合规、方便的交易功能。
>
> 建立一个进阶的去中心化彩票系统（可以是体育彩票，或其它任何比赛节目的竞猜，例如《中国好声音》《我是歌手》年度总冠军等，可以参考 [Polymarket](https://polymarket.com/) ），在网站中：
> - 公证人（你自己）可以创立许多竞猜项目：例如某场比赛的输赢、年度总冠军的得主等，每个项目应当有2个或多个可能的选项，一定的彩票总金额（由公证人提供），以及规定好的结果公布时间。
> - 玩家首先领取到测试所需以太币。在网站中，对于一个竞猜项目和多个可能的选项：
>   1. 每个竞彩玩家都可以选择其中的某个选项并购买一定金额（自己定义）的彩票，购买后该玩家会获得一张对应的彩票凭证（一个 ERC721 合约中的 Token）
>   2. 在竞彩结果公布之前，任何玩家之间可以买卖他们的彩票，以应对项目进行期间的任何突发状况。具体的买卖机制如下：一个玩家可以以指定的金额挂单出售（ERC721 Delegate）自己的彩票，其它玩家如果觉得该彩票有利可图就可以买入他的彩票。双方完成一次 ERC721 Token 交易。
>   3. 公证人可以在时间截止时（简单起见，你可以随时终止项目）输入竞猜的结果并进行结算。所有胜利的玩家可以平分奖池中的金额。
> - Bonus（最多5分，若想要完成，可以直接将功能整合进上述要求中）：
>   1. （2分）发行一个 ERC20 合约，允许用户领取 ERC20 积分，并使用ERC20积分完成上述流程。
>   2. （3分）对交易彩票的过程实现一个简单的链上订单簿：卖方用户可以以不同价格出售一种彩票，网页上显示当前订单簿的信息（多少价格有多少该彩票正在出售）。其他用户可以根据最优价格购买彩票。
> - 可以对上述需求进行合理更改和说明。请大家专注于功能实现，网站UI美观程度不纳入评分标准，能让用户能够舒适操作即可。

**以下内容为作业仓库的README.md中需要描述的内容。请根据自己的需要进行修改并提交。**

作业提交方式为：**提交视频文件**和**仓库的链接**到指定邮箱。

# EasyBet - 去中心化彩票竞猜系统

## 项目简介

本项目是一个进阶的去中心化彩票系统，允许用户创建竞猜项目、购买彩票并进行彩票交易。系统基于以太坊区块链技术，使用Solidity智能合约实现核心功能，前端使用React框架构建用户界面。

与传统彩票系统不同，本系统允许玩家在结果公布前交易其持有的彩票NFT，以应对项目进行期间的突发状况，提高彩票游戏的可玩性和灵活性。

## 功能实现分析

### 核心功能

1. **创建竞猜项目**
   - 公证人（项目创建者）可以创建竞猜项目，设定多个选项（至少2个）
   - 每个项目包含总奖金池、截止时间等信息
   - 奖金池由创建者提供，使用ERC20代币进行结算

2. **购买彩票**
   - 玩家可以选择竞猜项目的某个选项并购买彩票
   - 购买后获得一张对应的彩票凭证（ERC721 NFT Token）
   - 使用ERC20代币支付彩票费用

3. **彩票交易**
   - 在竞猜结果公布前，玩家可以交易持有的彩票NFT
   - 实现了链上订单簿功能，卖方可设定出售价格
   - 买方可查看订单簿并按价格购买彩票

4. **竞猜结算**
   - 公证人可以宣布竞猜结果
   - 系统自动结算奖金，获胜玩家平分奖池金额
   - 如果没有获胜者，奖金返回给项目创建者

### Bonus功能实现

1. **ERC20代币系统**
   - 实现了名为"EasyBet Token"(EBT)的ERC20代币
   - 提供水龙头功能，用户可以领取测试代币
   - 所有交易和结算均使用该代币完成

2. **链上订单簿**
   - 实现了完整的链上订单簿功能
   - 按价格组织销售订单，支持不同价格出售
   - 前端显示当前订单簿信息，包括各价格级别的挂单情况
   - 支持按最优价格购买彩票

## 如何运行

### 环境准备

1. 安装Node.js (建议版本16.x或以上)
2. 安装Ganache-cli作为本地以太坊测试网络
3. 安装MetaMask浏览器扩展并配置连接到Ganache

### 运行步骤

1. 在本地启动Ganache应用，确保RPC服务运行在`http://127.0.0.1:2853`
```bash
cd 
npx ganache-cli -p 2853 -d --db ./ganache-data --gasLimit 0x1fffffffffffff --gasPrice 0x1 --allowUnlimitedContractSize --noVMErrorsOnRPCResponse
```

2. 在 `./contracts` 目录中安装需要的依赖，运行如下命令：
```bash
npm install
```

3. 在 `./contracts` 目录中编译合约，运行如下命令：
```bash
npx hardhat compile
```

4. 部署智能合约到Ganache网络：
```bash
npx hardhat run scripts/deploy.ts --network ganache
```
部署完成后记录输出的合约地址，更新前端代码`./front/src/contract_utils.ts`中的地址配置。
```ts 
const EASY_TOKEN_ADDRESS = '0x2c5f3c004878923f55A2a255F89Fe29393177509'; // 修改为输出的合约地址
const EASY_BET_ADDRESS = '0x2f3efA6bbDC5fAf4dC1a600765c7B7829e47bE10'; // 修改为输出的合约地址
```

6. 在 `./frontend` 目录中安装需要的依赖，运行如下命令：
```bash
npm install
```

7. 在 `./frontend` 目录中启动前端程序，运行如下命令：
```bash
npm run start
```

8. 在MetaMask中连接到Ganache网络，并导入一个Ganache账户用于测试

## 项目运行截图

由于这是一个交互式应用，以下是关键界面和流程的说明：

### 1. 主界面和竞猜项目展示
- 显示所有创建的竞猜项目
- 可展开查看项目详细信息和选项

### 2. 创建新的竞猜项目
- 公证人可以填写选项内容、总奖金、截止时间等信息
- 需要预先批准并转入奖金到合约

### 3. 购买彩票
- 玩家可以选择任意项目和选项进行投注
- 需要批准代币转账并确认购买

### 4. 彩票交易和订单簿
- 用户可以将自己的彩票挂单出售，设定出售价格
- 其他用户可以查看订单簿并购买彩票
- 订单簿按价格组织，显示各价格级别的挂单情况

### 5. 竞猜结算
- 公证人可以宣布获胜选项
- 系统自动完成奖金分配给获胜玩家

## 技术架构

### 智能合约

1. **EasyToken.sol**
   - 基于ERC20标准的代币合约
   - 提供初始代币发行和水龙头功能

2. **EasyBet.sol**
   - 基于ERC721标准的彩票NFT合约
   - 实现竞猜项目管理、投注、交易和结算功能
   - 包含链上订单簿实现

### 前端应用

- 使用React和TypeScript构建
- 通过ethers.js与智能合约交互
- 实现响应式用户界面

## 参考内容

- 课程的参考Demo见：[DEMOs](https://github.com/LBruyne/blockchain-course-demos)。

- 快速实现 ERC721 和 ERC20：[模版](https://wizard.openzeppelin.com/#erc20)。记得安装相关依赖 ``"@openzeppelin/contracts": "^5.0.0"``。

- 如何实现ETH和ERC20的兑换？ [参考讲解](https://www.wtf.academy/en/docs/solidity-103/DEX/)

- OpenZeppelin Contracts: https://docs.openzeppelin.com/contracts/
